var Konsoll=function(t){if("object"!=typeof t&&(t={}),this.autoHide="boolean"==typeof t.autoHide?t.autoHide:!0,this.container=t.container?document.getElementById(t.container)||null:null,this.echo="boolean"==typeof t.echo?t.echo:!1,this.history="number"==typeof t.history?Math.abs(Math.round(t.history)):0,this.scrollback="number"==typeof t.scrollback?Math.max(-1,Math.round(t.scrollback)):-1,this.visible="boolean"==typeof t.visible?t.visible:!1,this.escHide="boolean"==typeof t.escHide?t.escHide:!0,this.callbacks={clear:this.clear.bind(this),help:this.help.bind(this)},this.inputHistory=[],this.mouseOver=!1,this.listElement=null,this.formElement=null,this.inputElement=null,this.container){for(var e=0;e<this.container.children.length;++e)if(("OL"==this.container.children[e].tagName||"UL"==this.container.children[e].tagName)&&(this.listElement=this.container.children[e]),"FORM"==this.container.children[e].tagName){this.formElement=this.container.children[e];for(var i=0;i<this.formElement.elements.length;++i){var n=this.formElement.elements[i];if("INPUT"==n.tagName&&"text"==n.type){this.inputElement=n;break}}}if(this.listElement||(this.listElement=document.createElement("OL"),this.container.appendChild(this.listElement)),!this.formElement){this.formElement=document.createElement("FORM"),this.inputElement=document.createElement("INPUT"),this.inputElement.setAttribute("type","text"),this.formElement.appendChild(this.inputElement);var s=document.createElement("INPUT");s.setAttribute("type","submit"),s.setAttribute("value","OK"),this.formElement.appendChild(s),this.container.appendChild(this.formElement)}this.formElement.addEventListener("submit",function(t){this.call(this.inputElement.value),this.inputElement.value="",this.inputElement.focus(),t.preventDefault()}.bind(this)),this.inputElement.addEventListener("keydown",function(t){if(this.history>0&&this.inputHistory.length){var e=this.inputHistory.indexOf(this.inputElement.value);38==t.keyCode?(this.inputElement.value=this.inputHistory[++e>=this.inputHistory.length?0:e],t.preventDefault()):40==t.keyCode&&(this.inputElement.value=this.inputHistory[--e<0?this.inputHistory.length-1:e],t.preventDefault())}}.bind(this)),this.container.addEventListener("mouseenter",function(){this.mouseOver=!0}.bind(this)),this.container.addEventListener("mouseleave",function(){this.mouseOver=!1}.bind(this)),document.addEventListener("click",function(){function t(e){if(document.activeElement==e)return!0;for(var i=0;i<e.children.length;++i)if(t(e.children[i]))return!0;return!1}(this.autoHide=!!this.autoHide)&&(this.mouseOver||t(this.container)||this.hide())}.bind(this)),this.visible?this.show():this.hide()}"number"==typeof t.toggleKey&&document.addEventListener("keydown",function(e){document.activeElement!=this.inputElement&&e.keyCode==Math.round(t.toggleKey)&&(this.toggle(),e.preventDefault())}.bind(this)),this.escHide&&document.addEventListener("keydown",function(t){this.visible&&27==t.keyCode&&this.hide()}.bind(this))};Konsoll.VERSION="0.1.2",Konsoll.AUTHORS=["Remi A. SolÃ¥s <remi@npolar.no>"],Konsoll.prototype={call:function(t){if(this.history>0){var e=this.inputHistory.indexOf(t);for(-1!=e&&this.inputHistory.splice(e,1),this.inputHistory.unshift(t);this.inputHistory.length>this.history;)this.inputHistory.pop()}this.echo&&this.log(t);var i=t.split(" ");this.callbacks[i[0]]?this.callbacks[i[0]](i.splice(1)):this.callbacks["*"]&&this.callbacks["*"](i)},callback:function(t,e){"string"==typeof t&&"function"==typeof e&&(this.callbacks[t]=e)},clear:function(){if(this.listElement)for(;this.listElement.children.length;)this.listElement.removeChild(this.listElement.firstChild)},help:function(){var t=[];for(var e in this.callbacks)"*"!=e&&t.push("<strong>"+e+"</strong>");this.log("Available commands: "+t.join(", "))},hide:function(){if(this.container&&this.formElement){for(var t,e=this.container.className.length?this.container.className.split(" "):[],i=0;i<this.formElement.children.length;++i)this.formElement.children[i].setAttribute("disabled","disabled"),this.formElement.children[i].blur();-1!=(t=e.indexOf("visible"))&&(e.splice(t,1),this.container.className=e.join(" ")),this.visible=!1}},show:function(){if(this.container&&this.formElement){for(var t=this.container.className.length?this.container.className.split(" "):[],e=0;e<this.formElement.children.length;++e)this.formElement.children[e].removeAttribute("disabled");-1==t.indexOf("visible")&&(t.push("visible"),this.container.className=t.join(" ")),this.inputElement.focus(),this.visible=!0}},toggle:function(){this.visible?this.hide():this.show()},write:function(t,e){function i(t){for(var e=[],n=0;n<t.length;++n)if(t[n]instanceof Array||t[n]instanceof Int8Array||t[n]instanceof Uint8Array||t[n]instanceof Int16Array||t[n]instanceof Uint16Array||t[n]instanceof Int32Array||t[n]instanceof Uint32Array||t[n]instanceof Float32Array||t[n]instanceof Float64Array)e.push("["+i(t[n])+"]");else if("object"==typeof t[n])e.push(JSON.stringify(t[n]));else if("number"==typeof t[n])e.push(t[n].toString());else if("string"==typeof t[n]){var s,l=t[n].split(" ");for(var o in l)(s=/^https?:\/\/.+/i.exec(l[o]))&&(l[o]=l[o].replace(s[0],'<a href="'+s[0]+'" title="Click to open URL">'+s[0]+"</a>"));e.push(l.join(" "))}else switch(t[n]){case void 0:e.push("undefined");break;case null:e.push("null");break;default:e.push(t[n])}return e.join(", ")}if(this.listElement&&e){var n=i(e),s=document.createElement("LI");t&&(s.className=t);var l=(new Date).toISOString(),o=/^(\d{4}(?:-\d{2}){2})T((?:\d{2}:){2}\d{2})/.exec(l);if(o&&(o=o[1]+", "+o[2],s.setAttribute("title",o)),s.innerHTML=n,this.listElement.appendChild(s),this.listElement.scrollTop=this.listElement.scrollHeight,this.scrollback>-1)for(;this.listElement.children.length>this.scrollback;)this.listElement.removeChild(this.listElement.firstChild)}},log:function(){this.write("",arguments)},info:function(){this.write("info",arguments)},warn:function(){this.write("warning",arguments)},error:function(){this.write("error",arguments)}};