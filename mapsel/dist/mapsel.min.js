var Mapsel=function(e){function t(e,t,i){if(t>i){var n=t;t=i,i=n}return Math.min(i,Math.max(t,e))}function i(e,t,n,s){var a=document.createElement(t);a.append=function(e,t,n){return i(a,e,t,n)};for(var l in n)a.setAttribute(l,n[l]);return void 0!==s&&(a.innerHTML=s),e.appendChild(a),a}e=e||{};var n=this;this.background=e.background||"#e3e3e3",this.container=e.container||null,this.closeable=e.closeable===!1?!1:!0,this.element=document.createElement("div"),this.elements={},this.events={},this.font={size:"14px"},this.height=e.height||250,this.instance=Mapsel.instances++,this.language=e.language||"en",this.latitude=t("number"==typeof e.latitude?e.latitude:65,-90,90),this.longitude=t("number"==typeof e.longitude?e.longitude:0,-90,90),this.map={api:null,marker:null},this.opacity=t("number"==typeof e.opacity?e.opacity:1,0,1),this.precision=t("number"==typeof e.precision?e.precision:2,0,8),this.radius=Math.max(Math.round(e.radius||0),0)||null,this.visible=e.visible===!1?!1:!0,this.width=e.width||200,this.x=e.x||0,this.y=e.y||0,this.element.append=function(e,t,s){return i(n.element,e,t,s)};for(var s=this.precision?"0.":"1",a=0;a<this.precision;++a)s+=a==this.precision-1?1:0;this.elements.titleBar=this.element.append("header"),this.elements.mapContainer=this.element.append("div",{id:"mapsel_map_"+this.instance}),this.elements.fieldset=this.element.append("fieldset"),this.closeable&&(this.elements.closeButton=this.elements.titleBar.append("a",{title:Mapsel.i18n[this.language].CLOSE},"X"),this.elements.closeButton.addEventListener("click",function(){n.hide()})),this.elements.latLabel=this.elements.fieldset.append("label",{"for":"mapsel_lat_"+this.instance},Mapsel.i18n[this.language].LATITUDE),this.elements.latInput=this.elements.fieldset.append("input",{id:"mapsel_lat_"+this.instance,type:"number",title:Mapsel.i18n[this.language].LATITUDE,min:-90,max:90,step:s,value:this.latitude}),this.elements.lngLabel=this.elements.fieldset.append("label",{"for":"mapsel_lng_"+this.instance},Mapsel.i18n[this.language].LONGITUDE),this.elements.lngInput=this.elements.fieldset.append("input",{id:"mapsel_lng_"+this.instance,type:"number",title:Mapsel.i18n[this.language].LONGITUDE,min:-180,max:180,step:s,value:this.longitude}),null!==this.radius&&(this.elements.radLabel=this.elements.fieldset.append("label",{"for":"mapsel_rad_"+this.instance},Mapsel.i18n[this.language].RADIUS),this.elements.radInput=this.elements.fieldset.append("input",{id:"mapsel_rad_"+this.instance,type:"number",title:Mapsel.i18n[this.language].RADIUS,step:1,value:this.radius})),this.element.className="mapsel",this.element.style.position=this.container?"relative":"absolute",this.element.style.background=this.background,this.element.style.fontSize=this.font.size,this.element.style.opacity=this.opacity,this.container?this.container.appendChild(this.element):document.body.appendChild(this.element),this.move(this.x,this.y),this.resize(this.width,this.height),this.visible?this.init():this.hide()};Mapsel.instances=0,Mapsel.prototype={on:function(e,t){"function"==typeof t?this.events[e]=t:this.events[e]&&delete this.events[e]},hide:function(){this.element&&(this.element.style.display="none"),this.visible=!1},focus:function(e){if(this.elements)switch(e){case"lat":case"latitude":this.elements.latInput&&this.elements.latInput.focus();break;case"lng":case"longitude":this.elements.lngInput&&this.elements.lngInput.focus();break;case"rad":case"radius":this.elements.radInput&&this.elements.radInput.focus()}},init:function(){var e=this;this.map.api=new google.maps.Map(this.elements.mapContainer,{center:{lat:this.latitude,lng:this.longitude},disableDoubleClickZoom:!0,mapTypeId:google.maps.MapTypeId.TERRAIN,streetViewControl:!1,zoom:2}),this.radius?(this.map.marker=new google.maps.Circle({center:this.map.api.getCenter(),draggable:!0,editable:!0,map:this.map.api,radius:this.radius}),google.maps.event.addListener(this.map.api,"dblclick",function(t){e.map.marker.setCenter(t.latLng)}),google.maps.event.addListener(this.map.marker,"center_changed",function(){var t=e.map.marker.getCenter(),i=Number(t.lat().toFixed(e.precision)),n=Number(t.lng().toFixed(e.precision));i!=e.latitude&&(e.elements.latInput.value=e.latitude=i,"function"==typeof e.events.latitude&&e.events.latitude(i)),n!=e.longitude&&(e.elements.lngInput.value=e.longitude=n,"function"==typeof e.events.longitude&&e.events.longitude(n))}),google.maps.event.addListener(this.map.marker,"radius_changed",function(){e.elements.radInput.value=e.radius=Math.round(e.map.marker.getRadius()),"function"==typeof e.events.radius&&e.events.radius(e.radius)}),this.elements.latInput.addEventListener("change",function(t){e.map.marker.setCenter({lat:Number(t.target.value),lng:e.longitude}),e.map.api.setCenter(e.map.marker.getCenter())}),this.elements.lngInput.addEventListener("change",function(t){e.map.marker.setCenter({lat:e.latitude,lng:Number(t.target.value)}),e.map.api.setCenter(e.map.marker.getCenter())}),this.elements.radInput.addEventListener("change",function(t){e.map.marker.setRadius(e.radius=Number(t.target.value))})):(this.map.marker=new google.maps.Marker({position:this.map.api.getCenter(),draggable:!0,map:this.map.api}),google.maps.event.addListener(this.map.api,"dblclick",function(t){e.map.marker.setPosition(t.latLng)}),google.maps.event.addListener(this.map.marker,"position_changed",function(){var t=e.map.marker.getPosition(),i=Number(t.lat().toFixed(e.precision)),n=Number(t.lng().toFixed(e.precision));i!=e.latitude&&(e.elements.latInput.value=e.latitude=i,"function"==typeof e.events.latitude&&e.events.latitude(i)),n!=e.longitude&&(e.elements.lngInput.value=e.longitude=n,"function"==typeof e.events.longitude&&e.events.longitude(n))}),this.elements.latInput.addEventListener("change",function(t){e.map.marker.setPosition({lat:Number(t.target.value),lng:e.longitude}),e.map.api.setCenter(e.map.marker.getPosition())}),this.elements.lngInput.addEventListener("change",function(t){e.map.marker.setPosition({lat:e.latitude,lng:Number(t.target.value)}),e.map.api.setCenter(e.map.marker.getPosition())}))},move:function(e,t,i){this.element&&(this.element.style.left=(i?this.x+=e:this.x=Math.max(e,0))+"px",this.element.style.top=(i?this.y+=t:this.y=Math.max(t,0))+"px")},resize:function(e,t,i){this.width=Math.max(i?this.width+=e:e,200),this.height=Math.max(i?this.height+=t:t,200);var n=0,s=document.createElement("span"),a=["LATITUDE","LONGITUDE","RADIUS"];s.style.fontSize=this.font.size,s.style.visibility="hidden",document.body.appendChild(s);for(var l in Mapsel.i18n[this.language])-1!=a.indexOf(l)&&(s.innerHTML=Mapsel.i18n[this.language][l],n=Math.max(n,s.offsetWidth));document.body.removeChild(s);var h=Math.ceil((n+15)/this.width*100),r=h+"%",d=100-h+"%",o=this.height,p=window.getComputedStyle(this.element,null);o-=parseInt(p.borderTopWidth)+parseInt(p.borderBottomWidth),o-=parseInt(p.paddingTop)+parseInt(p.paddingBottom),o-=this.elements.titleBar.offsetHeight,o-=this.elements.fieldset.offsetHeight,this.elements.latLabel.style.width=r,this.elements.latInput.style.width=d,this.elements.lngLabel.style.width=r,this.elements.lngInput.style.width=d,null!==this.radius&&(this.elements.radLabel.style.width=r,this.elements.radInput.style.width=d),this.element.style.width=this.width+"px",this.element.style.height=this.height+"px",this.elements.mapContainer.style.height=o+"px"},show:function(){this.element&&(this.element.style.display="block",this.map.api?this.map.api.setCenter({lat:this.latitude,lng:this.longitude}):this.init()),this.visible=!0}},Mapsel.i18n={en:{CLOSE:"Click to close",LATITUDE:"Latitude",LONGITUDE:"Longitude",RADIUS:"Radius"},ja:{CLOSE:"閉じます",LATITUDE:"緯度",LONGITUDE:"経度",RADIUS:"半径"},nb:{CLOSE:"Klikk for å lukke",LATITUDE:"Breddegrad",LONGITUDE:"Lengdegrad",RADIUS:"Radius"},nn:{CLOSE:"Klikk for å stengje",LATITUDE:"Breiddegrad",LONGITUDE:"Lengdegrad",RADIUS:"Radius"},yue:{CLOSE:"點擊關閉",LATITUDE:"緯度",LONGITUDE:"經度",RADIUS:"半徑"},zh:{CLOSE:"点击关闭",LATITUDE:"纬度",LONGITUDE:"经度",RADIUS:"半径"}},function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),i={".mapsel":["border: 1px solid #aaa","border-radius: 5px","box-shadow: 0 0 2px 0 #aaa","box-sizing: border-box","font-family: sans-serif","font-size: 0","padding: 5px","text-align: right"],".mapsel *":["border: 0","box-sizing: border-box","font-weight: normal","line-height: normal","margin: 0","padding: 0"],".mapsel header a":["color: #aaa","cursor: pointer","display: inline-block","font-size: inherit","font-weight: bold","margin: 0 2px 5px 0","text-decoration: none","text-shadow: 0 0 2px #ccc"],".mapsel header a:hover":["text-shadow: 0 0 1px #333"],".mapsel > div":["border: 1px solid #aaa","border-radius: 5px","display: block","width: 100%"],".mapsel fieldset label":["display: inline-block","font-size: inherit","padding-right: 5px","text-align: right","width: 40%"],".mapsel fieldset input":["border: 1px solid #aaa","border-radius: 5px","box-shadow: 0 0 2px 0 #aaa inset","font-size: inherit","margin-top: 5px","padding: 2px 5px","width: 60%"]};t.type="text/css";for(var n in i){var s=n+" {";for(var a in i[n])s+=i[n][a]+";";t.appendChild(document.createTextNode(s+"}"))}e.appendChild(t)}();