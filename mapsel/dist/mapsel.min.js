var Mapsel=function(e){function t(e,t,i){return Math.min(i,Math.max(t,e))}function i(e,t,i){var n=document.createElement(e);for(var s in t)n.setAttribute(s,t[s]);return void 0!==i&&(n.innerHTML=i),a.element.appendChild(n),n}e=e||{};var a=this;this.background=e.background||"#e3e3e3",this.container=e.container||null,this.closeable=e.closeable===!1?!1:!0,this.element=document.createElement("div"),this.elements={},this.font={size:"14px"},this.height=Math.max(e.height||250,250),this.instance=Mapsel.instances++,this.language=e.language||"en",this.latitude=t(e.latitude||65,-90,90),this.longitude=t(e.longitude||0,-180,180),this.map={api:null,marker:null},this.opacity=t(e.opacity||1,0,1),this.precision=t(e.precision||2,0,8),this.radius=Math.max(Math.round(e.radius||0),0)||null,this.visible=e.visible===!1?!1:!0,this.width=Math.max(e.width||200,200),this.x=e.x||0,this.y=e.y||0,this.closeable&&(this.elements.closeButton=i("a",{href:"#",title:Mapsel.i18n[this.language].CLOSE},"X"),this.elements.closeButton.addEventListener("click",function(){a.hide()}));for(var n=this.precision?"0.":"1",s=0;s<this.precision;++s)n+=s==this.precision-1?1:0;var l=0,r=document.createElement("span"),o=["LATITUDE","LONGITUDE","RADIUS"];r.style.fontSize=this.font.size,r.style.visibility="hidden",document.body.appendChild(r);for(var p in Mapsel.i18n[this.language])-1!=o.indexOf(p)&&(r.innerHTML=Mapsel.i18n[this.language][p],l=Math.max(l,r.offsetWidth));document.body.removeChild(r);var h=Math.ceil((l+15)/this.width*100),d="width: "+h+"%",m="width: "+(100-h)+"%";this.elements.mapContainer=i("div",{id:"mapsel_map_"+this.instance}),this.elements.latLabel=i("label",{"for":"mapsel_lat_"+this.instance,style:d},Mapsel.i18n[this.language].LATITUDE),this.elements.latInput=i("input",{id:"mapsel_lat_"+this.instance,style:m,type:"number",title:Mapsel.i18n[this.language].LATITUDE,min:-90,max:90,step:n,value:this.latitude}),this.elements.lngLabel=i("label",{"for":"mapsel_lng_"+this.instance,style:d},Mapsel.i18n[this.language].LONGITUDE),this.elements.lngInput=i("input",{id:"mapsel_lng_"+this.instance,style:m,type:"number",title:Mapsel.i18n[this.language].LONGITUDE,min:-180,max:180,step:n,value:this.longitude}),null!==this.radius&&(this.elements.radLabel=i("label",{"for":"mapsel_rad_"+this.instance,style:d},Mapsel.i18n[this.language].RADIUS),this.elements.radInput=i("input",{id:"mapsel_rad_"+this.instance,style:m,type:"number",title:Mapsel.i18n[this.language].RADIUS,step:1,value:this.radius})),this.element.className="mapsel",this.element.style.background=this.background,this.element.style.fontSize=this.font.size,this.element.style.height=this.height+"px",this.element.style.left=this.x+"px",this.element.style.opacity=this.opacity,this.element.style.top=this.y+"px",this.element.style.width=this.width+"px",this.elements.mapContainer.style.height=this.height-((this.closeable?30:10)+30*(this.radius?3:2))+"px",this.map.api=new google.maps.Map(this.elements.mapContainer,{center:{lat:this.latitude,lng:this.longitude},disableDoubleClickZoom:!0,mapTypeId:google.maps.MapTypeId.TERRAIN,streetViewControl:!1,zoom:1}),this.radius?(this.map.marker=new google.maps.Circle({center:this.map.api.getCenter(),draggable:!0,editable:!0,map:this.map.api,radius:this.radius}),google.maps.event.addListener(this.map.api,"dblclick",function(e){a.map.marker.setCenter(e.latLng)}),google.maps.event.addListener(this.map.marker,"center_changed",function(){var e=a.map.marker.getCenter();a.elements.latInput.value=a.latitude=Number(e.lat().toFixed(a.precision)),a.elements.lngInput.value=a.longitude=Number(e.lng().toFixed(a.precision))}),google.maps.event.addListener(this.map.marker,"radius_changed",function(){a.elements.radInput.value=a.radius=Math.round(a.map.marker.getRadius())}),this.elements.latInput.addEventListener("change",function(e){a.map.marker.setCenter({lat:Number(e.target.value),lng:a.longitude}),a.map.api.setCenter(a.map.marker.getCenter())}),this.elements.lngInput.addEventListener("change",function(e){a.map.marker.setCenter({lat:a.latitude,lng:Number(e.target.value)}),a.map.api.setCenter(a.map.marker.getCenter())}),this.elements.radInput.addEventListener("change",function(e){a.map.marker.setRadius(a.radius=Number(e.target.value))})):(this.map.marker=new google.maps.Marker({position:this.map.api.getCenter(),draggable:!0,map:this.map.api}),google.maps.event.addListener(this.map.api,"dblclick",function(e){a.map.marker.setPosition(e.latLng)}),google.maps.event.addListener(this.map.marker,"position_changed",function(){var e=a.map.marker.getPosition();a.elements.latInput.value=a.latitude=Number(e.lat().toFixed(a.precision)),a.elements.lngInput.value=a.longitude=Number(e.lng().toFixed(a.precision))}),this.elements.latInput.addEventListener("change",function(e){a.map.marker.setPosition({lat:Number(e.target.value),lng:a.longitude}),a.map.api.setCenter(a.map.marker.getPosition())}),this.elements.lngInput.addEventListener("change",function(e){a.map.marker.setPosition({lat:a.latitude,lng:Number(e.target.value)}),a.map.api.setCenter(a.map.marker.getPosition())})),this.container?this.container.appendChild(this.element):document.body.appendChild(this.element)};Mapsel.instances=0,Mapsel.prototype={hide:function(){this.element&&(this.element.style.display="none"),this.visible=!1},show:function(){this.element&&(this.element.style.display="block",this.map.api&&this.map.api.setCenter({lat:this.latitude,lng:this.longitude})),this.visible=!0}},Mapsel.i18n={en:{CLOSE:"Click to close",LATITUDE:"Latitude",LONGITUDE:"Longitude",RADIUS:"Radius"},ja:{CLOSE:"閉じます",LATITUDE:"緯度",LONGITUDE:"経度",RADIUS:"半径"},nb:{CLOSE:"Klikk for å lukke",LATITUDE:"Breddegrad",LONGITUDE:"Lengdegrad",RADIUS:"Radius"},nn:{CLOSE:"Klikk for å stengje",LATITUDE:"Breiddegrad",LONGITUDE:"Lengdegrad",RADIUS:"Radius"},yue:{CLOSE:"點擊關閉",LATITUDE:"緯度",LONGITUDE:"經度",RADIUS:"半徑"},zh:{CLOSE:"点击关闭",LATITUDE:"纬度",LONGITUDE:"经度",RADIUS:"半径"}},function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style"),i={".mapsel":["border-radius: 5px","box-sizing: border-box","font-family: sans-serif","font-size: 0","padding: 5px","position: relative","text-align: right"],".mapsel > a":["color: #aaa","display: inline-block","font-size: inherit","font-weight: bold","margin: 0 2px 2px 2px","text-decoration: none","text-shadow: 0 0 2px #ccc"],".mapsel > a:hover":["text-shadow: 0 0 1px #333"],".mapsel > div":["border-radius: 5px","display: block","width: 100%"],".mapsel > label":["box-sizing: border-box","display: inline-block","font-size: inherit","padding-right: 5px","text-align: right","width: 40%"],".mapsel > input":["box-sizing: border-box","font-size: inherit","margin-top: 5px","padding: 2px 5px","width: 60%"]};t.type="text/css";for(var a in i){var n=a+" {";for(var s in i[a])n+=i[a][s]+";";t.appendChild(document.createTextNode(n+"}"))}e.appendChild(t)}();